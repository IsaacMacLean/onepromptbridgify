<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduTech One Prompt Player</title>
  <link rel="icon" type="image/png" href="edutechlogo2.png">
  <style>
    body {
      font-family: Times New Roman, serif;
      background-color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      padding-right: 220px;
      /* Prevent content from being hidden by the controls */
    }

    body.black-background {
      background-color: black;
    }

    #videoContainer {
      position: relative;
      width: 640px;
      height: 360px;
      margin: auto;
    }

    #textOverlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      background-color: transparent;
      z-index: 10;
    }

    .text,
    .white-layer,
    .outline {
      font-size: 5vw;
      font-weight: bold;
      text-align: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
      margin: 0;
    }

    .text {
      color: #ff0000;
    }

    .white-layer {
      z-index: 2;
      color: white;
      -webkit-text-stroke: 5px white;
      text-stroke: 5px white;
    }

    .outline {
      z-index: 1;
      -webkit-text-stroke: 10px black;
      text-stroke: 10px black;
      color: transparent;
    }

    #controls {
      position: fixed;
      /* Adjusted to fixed for right screen alignment */
      top: 0;
      right: 0;
      width: 200px;
      background-color: #f0f0f0;
      height: 100vh;
      /* To cover full screen height */
      padding: 10px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      /* Allow scrolling within the controls column */
    }

    button {
      background-color: #0275ff;
      /* Pleasant blue */
      color: #ffffff;
      /* White text */
      padding: 10px 20px;
      /* Increased padding */
      border: none;
      border-radius: 5px;
      /* Rounded edges */
      cursor: pointer;
      /* Clickable cursor style */
      font-weight: bold;
      /* Bold text */
      margin-top: 10px;
      /* Margin at the top */
      transition: background-color 0.3s;
      /* Smooth transition for hover effect */
    }

    button:hover {
      background-color: #015dcc;
    }

    input,
    select,
    label {
      margin: 5px;
      margin-bottom: 10px;
      /* Increased space between form elements */
      display: block;
      width: calc(100% - 10px);
      /* Adjust width */
      box-sizing: border-box;
      /* Include padding in width */
    }

    #videoPlayer {
      z-index: 1;
      visibility: hidden;
    }
  </style>
</head>

<body>
  <div id="videoContainer">
    <video id="videoPlayer" width="640" height="360" controls></video>
    <div id="textOverlay">
      <div id="styledText" class="text"></div>
      <div id="whiteLayer" class="white-layer"></div>
      <div id="outlinedText" class="outline"></div>
    </div>
    <div id="controls">
      <label for="videoInput">Upload Video:</label>
      <input type="file" id="videoInput" accept="video/*" onchange="loadVideo(event)">
      <label for="intervalTime">Interval Time (s):</label>
      <input type="number" id="intervalTime" value="10">
      <label for="textContent">Text Content:</label>
      <input type="text" id="textContent" placeholder="Enter text" oninput="updateText()" value="WORD BUBBLING">
      <label for="textSize">Text Size:</label>
      <input type="range" id="textSize" min="5" max="25" value="15" oninput="updateText()">
      <label for="textColor">Text Color:</label>
      <input type="color" id="textColor" value="#000000" onchange="updateText()">
      <label for="outlineColor">Outline Color:</label>
      <input type="color" id="outlineColor" value="#ff0000" onchange="updateText()">
      <label for="outlineWidth">Outline Width:</label>
      <input type="range" id="outlineWidth" min="0" max="60" value="45" oninput="updateText()">
      <label for="letterSpacing">Letter Spacing:</label>
      <input type="range" id="letterSpacing" min="-5" max="60" value="0" oninput="updateText()">
      <label for="fontStyle">Font Style:</label>
      <select id="fontStyle" onchange="updateText()">
        <option value="Comic Sans MS, cursive">Comic Sans MS</option>
        <option value="Calibri, sans-serif">Calibri</option>
        <option value="Arial, sans-serif">Arial</option>
      </select>
      <label for="bgColor">Background Color:</label>
      <select id="bgColor" onchange="updateBackgroundColor()">
        <option value="black">Black</option>
        <option value="white">White</option>
      </select>
      <button id="playButton" onclick="startVideo()">Start Video</button>
    </div>
  </div>
  <script>
    let isPausedByUser = false;
    let intervalId;
    let lastPauseTime = 0;
    let isTextToSpeechEnabled = true;
    let textToSpeak = "";
    let canPause = false; // Variable to track if the user can pause

    function loadVideo(event) {
      const file = event.target.files[0];
      const videoPlayer = document.getElementById('videoPlayer');
      videoPlayer.src = URL.createObjectURL(file);
      videoPlayer.load();
    }

    function startVideo() {
      const videoPlayer = document.getElementById('videoPlayer');
      const intervalTime = parseInt(document.getElementById('intervalTime').value, 10);
      const selectedBackgroundColor = document.getElementById('bgColor').value;

      if (isNaN(intervalTime) || intervalTime <= 0) {
        alert("Please enter a valid interval time.");
        return;
      }

      const controls = document.getElementById('controls');
      controls.style.display = 'none';

      document.body.style.paddingRight = '0px'; // Dynamically adjust the body's right padding

      // Apply the background color change only when video starts if black is selected
      if (selectedBackgroundColor === 'black') {
        document.body.classList.add('black-background');
      }

      videoPlayer.style.visibility = 'visible';
      document.getElementById('playButton').style.display = 'none';
      videoPlayer.play();
      requestFullScreen(videoPlayer);

      document.addEventListener('click', resumeVideo);
      document.addEventListener('keypress', resumeVideo);
      document.addEventListener('contextmenu', endProgram);

      videoPlayer.addEventListener('pause', () => {
        if (canPause) {
          showTextOverlay(true);
          isPausedByUser = true;
          videoPlayer.style.display = 'none';
          lastPauseTime = videoPlayer.currentTime;
        }
      });

      videoPlayer.addEventListener('play', hideTextOverlay);

      videoPlayer.addEventListener('click', function (event) {
        if (!canPause || !isPausedByUser) {
          event.preventDefault();
        }
      });

      videoPlayer.addEventListener('dblclick', (event) => {
        event.preventDefault();
      });

      function checkPauseInterval() {
        if (!isPausedByUser && videoPlayer.currentTime - lastPauseTime >= intervalTime) {
          canPause = true;
          videoPlayer.pause();
          showTextOverlay(true);
          isPausedByUser = true;
          lastPauseTime = videoPlayer.currentTime;
        }
      }

      intervalId = setInterval(checkPauseInterval, 500);

      // Updated onended event with redirection after 3 seconds
      videoPlayer.onended = () => {
        clearInterval(intervalId);
        document.removeEventListener('click', resumeVideo);
        document.removeEventListener('keypress', resumeVideo);
        document.body.classList.remove('black-background');
        document.body.style.paddingRight = '220px'; // Reintroduce the right padding

        // Wait for 3 seconds before redirecting
        setTimeout(function () {
          window.location.href = 'https://2f3ab617-822c-48be-8bad-9c4866c2fad0-00-2lof2ie1j0lfq.picard.replit.dev/';
        }, 3000); // 3000 milliseconds = 3 seconds
      };
    }

    function showTextOverlay(readText = false) {
      const textOverlay = document.getElementById('textOverlay');
      textOverlay.style.display = 'flex';

      function loopText() {
        if (!isPausedByUser) return;
        updateText(document.getElementById('textContent').value);
        if (isTextToSpeechEnabled) {
          speakText(document.getElementById('textContent').value, () => {
            textOverlay.addEventListener('click', () => {
              const videoPlayer = document.getElementById('videoPlayer');
              videoPlayer.play();
              isPausedByUser = false;
              hideTextOverlay();
              textOverlay.removeEventListener('click', resumeVideo);
            });
          });
        } else {
          textOverlay.addEventListener('click', () => {
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.play();
            isPausedByUser = false;
            hideTextOverlay();
            textOverlay.removeEventListener('click', resumeVideo);
          });
        }
      }

      if (readText && isTextToSpeechEnabled) {
        loopText();
      }
    }

    function hideTextOverlay() {
      const textOverlay = document.getElementById('textOverlay');
      textOverlay.style.display = 'none';
    }

    function resumeVideo(event) {
      if (event.type === 'click' && (event.button === 0 || event.button === 2)) {
        if (canPause && isPausedByUser) {
          hideTextOverlay();
          const videoPlayer = document.getElementById('videoPlayer');
          videoPlayer.style.display = 'block';
          updateText(document.getElementById('textContent').value);
          textToSpeak = document.getElementById('textContent').value;

          const synth = window.speechSynthesis;
          if (synth.speaking) {
            synth.cancel();
          }

          if (isTextToSpeechEnabled) {
            speakText(textToSpeak, () => {
              videoPlayer.play();
              isPausedByUser = false;
              hideTextOverlay();
            });
          } else {
            videoPlayer.play();
            isPausedByUser = false;
            hideTextOverlay();
          }

          canPause = false;
        }
      } else {
        event.preventDefault();
      }
    }

    function requestFullScreen(element) {
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.mozRequestFullScreen) {
        element.mozRequestFullScreen();
      } else if (element.webkitRequestFullscreen) {
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen();
      }
    }

    function updateText(newText = null) {
      if (newText !== null) {
        textToSpeak = newText;
      }

      const textContent = newText || document.getElementById('textContent').value;
      const textSize = document.getElementById('textSize').value + 'vw';
      const textColor = document.getElementById('textColor').value;
      const outlineWidth = document.getElementById('outlineWidth').value * 0.7 + 'px';
      const outlineColor = document.getElementById('outlineColor').value;
      const letterSpacing = document.getElementById('letterSpacing').value + 'px';
      const fontStyle = document.getElementById('fontStyle').value;

      const styledText = document.getElementById('styledText');
      const whiteLayer = document.getElementById('whiteLayer');
      const outlinedText = document.getElementById('outlinedText');

      styledText.innerHTML = `<div id="promptText">${textContent}</div>`;
      styledText.style.fontSize = textSize;
      styledText.style.color = textColor;
      styledText.style.fontFamily = fontStyle || "Comic Sans MS, cursive";
      styledText.style.letterSpacing = letterSpacing;

      whiteLayer.innerHTML = `<div id="promptText">${textContent}</div>`;
      whiteLayer.style.fontSize = textSize;
      whiteLayer.style.fontFamily = fontStyle || "Comic Sans MS, cursive";
      whiteLayer.style.color = 'white';
      whiteLayer.style.letterSpacing = letterSpacing;

      outlinedText.innerHTML = `<div id="promptText">${textContent}</div>`;
      outlinedText.style.fontSize = textSize;
      outlinedText.style.color = textColor;
      outlinedText.style.fontFamily = fontStyle || "Comic Sans MS, cursive";
      outlinedText.style.webkitTextStroke = outlineWidth + ' ' + outlineColor;
      outlinedText.style.textStroke = outlineWidth + ' ' + outlineColor;
      outlinedText.style.letterSpacing = letterSpacing;
    }

    function toggleTextToSpeech() {
      isTextToSpeechEnabled = !isTextToSpeechEnabled;
      const toggleButton = document.getElementById('toggleSpeech');
      toggleButton.innerText = isTextToSpeechEnabled ? 'Disable Text-to-Speech' : 'Enable Text-to-Speech';
    }

    function speakText(text, callback) {
      const synth = window.speechSynthesis;
      if (synth.speaking) {
        console.log('Already speaking...');
        return;
      }
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.8;

      utterance.onend = function (event) {
        if (callback) callback();
      };

      synth.speak(utterance);
    }

    function endProgram(event) {
      event.preventDefault();
    }

    function updateBackgroundColor() {
      const bgColor = document.getElementById('bgColor').value;
      if (bgColor !== 'black') {
        document.body.classList.remove('black-background');
        if (bgColor === 'white') {
          document.body.style.backgroundColor = 'white';
        }
      }
    }

    updateText();
    showTextOverlay();
  </script>
</body>

</html>